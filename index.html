<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R&D Problem Submission Portal</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(to bottom right, #e0f2fe, #ffffff);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
.container {
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}
form {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  width: 100%;
  max-width: 400px;
}
input, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
}
button {
  background: linear-gradient(to right, #2563eb, #06b6d4);
  color: white;
  border: none;
  cursor: pointer;
  font-weight: bold;
}
button:hover {
  opacity: 0.9;
}
.hidden { display: none; }
footer {
  background: #1e3a8a;
  color: white;
  text-align: center;
  padding: 10px;
}
.button-row {
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-bottom:10px;
}
.button-row button {
  width:auto;
  padding:6px 10px;
  font-size:14px;
  border-radius:6px;
}
.button-dashboard {
  background:#2563eb;
  color:white;
}
.button-logout {
  background:#dc2626;
  color:white;
}
</style>
</head>

<body>

<!-- Login Section -->
<div id="authSection" class="container">
  <form id="authForm">
    <h2 style="text-align:center;color:#2563eb;">R&D Student Login</h2>
    <p style="text-align:center;color:gray;font-size:14px;">Only registered students can access</p>
    <input id="authEmail" type="email" placeholder="Email" required>
    <input id="authPassword" type="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
</div>

<!-- Problem Submission Form -->
<div id="formSection" class="container hidden">
  <form id="problemForm">
    <div class="button-row">
      <button type="button" class="button-dashboard" onclick="window.location.href='studash.html'">
        ðŸ“Š Go to Dashboard
      </button>
      <button type="button" id="logoutBtn" class="button-logout">
        Logout
      </button>
    </div>

    <h2 style="text-align:center;color:#2563eb;">Submit Your R&D Problem</h2>
    <input type="text" id="studentName" placeholder="Your Name" required>
    <input type="text" id="department" placeholder="Department" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="title" placeholder="Problem Title" required>
    <textarea id="description" placeholder="Problem Description" rows="4" required></textarea>
    <button type="submit">Submit Problem</button>
  </form>
</div>

<footer>
  <p>Â© 2025 R&D Cell Hub. All Rights Reserved.</p>
</footer>

<!-- Firebase (compat version for WebView) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBEwqlqlN446o8nY3dDHSZ4ABmZiVQIID8",
  authDomain: "rdportal-e5497.firebaseapp.com",
  projectId: "rdportal-e5497",
  storageBucket: "rdportal-e5497.appspot.com",
  messagingSenderId: "95071114633",
  appId: "1:95071114633:web:a853403cc2520d65c7fd58"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const authSection = document.getElementById("authSection");
const formSection = document.getElementById("formSection");
const authForm = document.getElementById("authForm");
const problemForm = document.getElementById("problemForm");
const logoutBtn = document.getElementById("logoutBtn");

// Login
authForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const email = document.getElementById("authEmail").value;
  const password = document.getElementById("authPassword").value;

  auth.signInWithEmailAndPassword(email, password)
    .then(async (userCredential) => {
      const user = userCredential.user;
      const ref = db.collection("allowed_users").doc(user.email);
      const docSnap = await ref.get();

      if (docSnap.exists) {
        authSection.classList.add("hidden");
        formSection.classList.remove("hidden");
      } else {
        alert("You are not authorized to access this portal.");
        auth.signOut();
      }
    })
    .catch(() => alert("Invalid login or access denied!"));
});

// Submit Problem
problemForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const data = {
    studentName: document.getElementById("studentName").value,
    department: document.getElementById("department").value,
    email: document.getElementById("email").value,
    title: document.getElementById("title").value,
    description: document.getElementById("description").value,
    status: "Pending",
    timestamp: new Date()
  };
  try {
    await db.collection("problems").add(data);
    alert("âœ… Problem submitted successfully!");
    problemForm.reset();
  } catch (err) {
    alert("Error submitting problem!");
  }
});

// Logout
logoutBtn.addEventListener("click", () => {
  auth.signOut();
  formSection.classList.add("hidden");
  authSection.classList.remove("hidden");
});
</script>

</body>
</html>
